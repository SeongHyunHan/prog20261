<!DOCTYPE html>
<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="icon" href="data:;base64,iVBORw0KGgo=">

        <!-- Note! Below we load jQuery and jQuery Mobile for Google CDN Library.
             In General (and for your Assignment N2!) you must use locad jQuery and jQuery Mobile libraries locally!!!. -->
        <!--<script src="libs/jquery/jquery.min.js" type="text/javascript"></script>
        <link href="libs/jquery-mobile/jquery.mobile.min.css" rel="stylesheet" type="text/css"/>
        <script src="libs/jquery-mobile/jquery.mobile.min.js" type="text/javascript"></script>-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
        <title>Assignment2_SeongHyunHan</title>
    </head>
    <body>
          <div data-role="page" id="storage">
            <div data-role="content">
                <div class="ui-field-contain">
                  <label for="name">Full Name:</label>
                  <input type="text" id="name" name="name" autofocus
                       placeholder="Enter your full name">
                </div>

                <div class="ui-field-contain">
                  <label for="email">Email:</label>
                  <input type="text" id="email" name="email"
                       placeholder="Enter your e-mail">
                </div>
                  <label for="age">Age:</label>
                  <input type="range" id="age" name="age"
                        value=60 min=0 max=100>
                <div calss="ui-field-contain">

                </div>

                <div id="pop" data-role="popup" data-position-to="window" data-transition="true"></div>

                <button id="getBtn" class="ui-btn ui-icon-action ui-btn-icon-left">Get Info</button>
            </div>


        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script>
          var jqmReady=$.Deferred();
          var pgReady=$.Deferred();
          var db=null;

            $(document).on("pagecreate",  jqmReady.resolve);
            document.addEventListener("deviceready",pgReady.resolve,false);
           // window.addEventListener("load",pgReady.resolve,false);

           $.when(jqmReady,pgReady).then (function(){

                // Create connection to SQLite database
                db = window.sqlitePlugin.openDatabase({name: 'student.db', location: 'default'});
                var $email=$('#email');
                var $name=$('#name');
                var $pop=$("#pop");

                // We are going to execute a few transactions. This is for demo only!
		// Use tutorial: https://github.com/litehelpers/Cordova-sqlite-storage#readme
                db.transaction(function(tx) {
                    // Remove the line below for Assignment N2!
                    tx.executeSql('DROP TABLE IF EXISTS Student');

                    // Create table "Student" where we'll keep all students
                    tx.executeSql('CREATE TABLE IF NOT EXISTS Student (email TEXT PRIMARY KEY, name TEXT)');

                    // Add two "fake" students so you can test the assignment.
		    // This is for demo only!
                    tx.executeSql('INSERT INTO Student VALUES (?,?)', ['alex@alex.com', 'Alex Alex']);
                    tx.executeSql('INSERT INTO Student VALUES (?,?)', ['john@john.com', 'John John']);

                }, function(error) {
                    console.log('Transaction ERROR: ' + error.message);

                }, function() {
                        console.log('Populated database OK');
                });


                $('#getBtn').click(function(event){
                    // We need this line to prevent default "submit" action on the buttons
                    event.preventDefault();

                    // Check that email not empty!
                    var email=$email.val();
                    if (email.length < 3) {
                        shosPopup("Email is too short");
			return;
                    }

		    // Here we assume that email does exist. It's not always the case!
                    db.executeSql('SELECT name FROM Student WHERE email LIKE "' + email + '"', [], function(rs) {
                      $name.val(  rs.rows.item(0).name );

                    }, function(error) {
                      console.log('SELECT SQL statement ERROR: ' + error.message);
                    });

                });

                function showPopup(msg){
                    $("#pop").html("<p>"+msg+"</p>").popup("open");
                    setTimeout(function() $pop.popup("close"), 1000);
                }


           });
        </script>
    </body>
</html>
